version: '3.8'

services:
  governance-oracle:
    build: .
    environment:
      - DASH_CORE_HOST=${DASH_CORE_HOST:-dashd}
      - DASH_CORE_PORT=${DASH_CORE_PORT:-9998}
      - DASH_CORE_USERNAME=${DASH_CORE_USERNAME:-dashrpc}
      - DASH_CORE_PASSWORD=${DASH_CORE_PASSWORD}
      - PLATFORM_NETWORK=${PLATFORM_NETWORK:-testnet}
      - PLATFORM_IDENTITY_ID=${PLATFORM_IDENTITY_ID}
      - PLATFORM_PRIVATE_KEY=${PLATFORM_PRIVATE_KEY}
      - GOVERNANCE_CONTRACT_ID=${GOVERNANCE_CONTRACT_ID}
      - SYNC_PROPOSAL_INTERVAL_MS=${SYNC_PROPOSAL_INTERVAL_MS:-300000}
      - SYNC_VOTE_INTERVAL_MS=${SYNC_VOTE_INTERVAL_MS:-300000}
      - SYNC_MASTERNODE_INTERVAL_MS=${SYNC_MASTERNODE_INTERVAL_MS:-3600000}
      - HEALTH_PORT=${HEALTH_PORT:-8080}
      - LOG_LEVEL=${LOG_LEVEL:-info}
    ports:
      - "${HEALTH_PORT:-8080}:8080"
    restart: unless-stopped
    depends_on:
      - dashd

  dashd:
    image: dashpay/dashd:latest
    volumes:
      - dashdata:/dash/.dashcore
    command:
      - "-server=1"
      - "-rpcuser=${DASH_CORE_USERNAME:-dashrpc}"
      - "-rpcpassword=${DASH_CORE_PASSWORD}"
      - "-rpcallowip=0.0.0.0/0"
      - "-rpcbind=0.0.0.0"
      - "-txindex=1"
    restart: unless-stopped

volumes:
  dashdata:
